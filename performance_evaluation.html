<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>研发团队效能评分系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .upload-box:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .upload-box.has-file {
            border-color: #27ae60;
            background: #f0fff4;
        }

        .upload-box input[type="file"] {
            display: none;
        }

        .upload-label {
            display: block;
            cursor: pointer;
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .upload-box.has-file .upload-label {
            color: #27ae60;
        }

        .file-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        .process-btn {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 15px 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .process-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 文件夹上传样式 */
        .folder-upload-section {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 2px dashed #6c757d;
            text-align: center;
            transition: all 0.3s ease;
        }

        .folder-upload-section:hover {
            border-color: #3498db;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .folder-upload-section.has-folder {
            border-color: #27ae60;
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
        }

        .folder-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.2em;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }

        .folder-upload-section:hover .folder-upload-label {
            color: #3498db;
        }

        .folder-upload-section.has-folder .folder-upload-label {
            color: #27ae60;
        }

        .folder-upload-input {
            display: none;
        }

        .folder-upload-description {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .folder-upload-section.has-folder .folder-upload-description {
            color: #155724;
        }

        .folder-status {
            display: inline-block;
            padding: 6px 12px;
            background: #e9ecef;
            color: #495057;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            margin-top: 10px;
        }

        .folder-upload-section.has-folder .folder-status {
            background: #d4edda;
            color: #155724;
        }

        .quick-upload-separator {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: #6c757d;
        }

        .quick-upload-separator::before,
        .quick-upload-separator::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #dee2e6;
        }

        .quick-upload-separator span {
            padding: 0 15px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .batch-file-list {
            margin-top: 15px;
            text-align: left;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 15px;
            display: none;
        }

        .folder-upload-section.has-folder .batch-file-list {
            display: block;
        }

        .batch-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        .batch-file-item:last-child {
            border-bottom: none;
        }

        .batch-file-name {
            font-weight: 500;
            color: #495057;
        }

        .batch-file-status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .file-status-found {
            background: #d4edda;
            color: #155724;
        }

        .file-status-missing {
            background: #f8d7da;
            color: #721c24;
        }

        .results-section {
            padding: 40px;
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .export-btn {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .export-btn:hover {
            background: #219a52;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        /* Column-specific width classes */
        .col-rank { width: 60px; min-width: 60px; }
        .col-name { width: 120px; min-width: 120px; }
        .col-overdue-ratio { width: 110px; min-width: 110px; }
        .col-overdue-days { width: 110px; min-width: 110px; }
        .col-work-days { width: 110px; min-width: 110px; }
        .col-score { width: 90px; min-width: 90px; }
        .col-grade { width: 80px; min-width: 80px; }
        .col-explanation { min-width: 500px; width: auto; }

        .results-table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* 视图切换按钮 */
        .view-toggle {
            display: flex;
            gap: 5px;
        }

        .view-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            background: #f8f9fa;
        }

        .view-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        /* 分析报告样式 */
        .analysis-report {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }

        .report-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
        }

        .report-header h1 {
            font-size: 2em;
            margin: 0;
        }

        .analysis-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .analysis-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .stats-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stats-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stats-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stats-label {
            color: #666;
            font-size: 0.9em;
        }

        .grade-bars {
            display: grid;
            gap: 10px;
        }

        .grade-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .grade-label {
            min-width: 60px;
            font-weight: bold;
        }

        .grade-S { color: #2ecc71; }
        .grade-A { color: #3498db; }
        .grade-B { color: #f39c12; }
        .grade-C { color: #e67e22; }
        .grade-D { color: #e74c3c; }

        .progress-bar {
            flex: 1;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-fill.grade-S { background: #2ecc71; }
        .progress-fill.grade-A { background: #3498db; }
        .progress-fill.grade-B { background: #f39c12; }
        .progress-fill.grade-C { background: #e67e22; }
        .progress-fill.grade-D { background: #e74c3c; }

        .grade-percentage {
            min-width: 50px;
            text-align: right;
            font-size: 0.9em;
            color: #666;
        }

        .analysis-list {
            list-style: none;
            padding: 0;
        }

        .analysis-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .analysis-item.highlight {
            border-left: 4px solid #2ecc71;
        }

        .analysis-item.lowlight {
            border-left: 4px solid #e74c3c;
        }

        .analysis-item.review {
            border-left: 4px solid #f39c12;
        }

        .employee-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .employee-score {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .employee-explanation {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }

        .suggestions-list {
            list-style: none;
            padding: 0;
        }

        .suggestion-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            font-size: 0.95em;
            line-height: 1.4;
        }

        .grade {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            min-width: 30px;
            display: inline-block;
        }

        .grade-S { background: #2ecc71; color: white; }
        .grade-A { background: #3498db; color: white; }
        .grade-B { background: #f39c12; color: white; }
        .grade-C { background: #e67e22; color: white; }
        .grade-D { background: #e74c3c; color: white; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .stat-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .stat-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 700;
            color: #212529;
            font-size: 16px;
        }

        /* 紧凑型统计网格 */
        .stats-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .stats-compact .stat-item {
            margin-bottom: 0;
            padding: 10px 12px;
        }

        .stats-compact .stat-label {
            font-size: 13px;
        }

        .stats-compact .stat-value {
            font-size: 15px;
        }

        /* 状态指示器 */
        .stat-value.good {
            color: #27ae60;
        }

        .stat-value.warning {
            color: #f39c12;
        }

        .stat-value.danger {
            color: #e74c3c;
        }

        .stat-value.info {
            color: #3498db;
        }

        /* 分析区块优化 */
        .analysis-section {
            margin-bottom: 24px;
        }

        .analysis-section h3 {
            margin-bottom: 16px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
        }

        /* 小型标签 */
        .stat-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        /* Lowlight需关注 - 优化样式 */
        .lowlight-alert {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.15);
            position: relative;
            overflow: hidden;
        }

        .lowlight-alert::before {
            content: '⚠️';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 60px;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .lowlight-alert.critical {
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
            color: white;
            animation: pulse-alert 2s infinite;
        }

        @keyframes pulse-alert {
            0% { box-shadow: 0 4px 12px rgba(231, 76, 60, 0.15); }
            50% { box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4); }
            100% { box-shadow: 0 4px 12px rgba(231, 76, 60, 0.15); }
        }

        .lowlight-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(231, 76, 60, 0.2);
        }

        .lowlight-title {
            font-size: 16px;
            font-weight: 600;
            color: #e74c3c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lowlight-alert.critical .lowlight-title {
            color: white;
        }

        .lowlight-urgency {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .lowlight-content {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: start;
        }

        .lowlight-info {
            flex: 1;
        }

        .lowlight-employee {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .lowlight-score {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .lowlight-alert.critical .lowlight-score {
            color: rgba(255, 255, 255, 0.8);
        }

        .lowlight-actions {
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
        }

        .lowlight-alert.critical .lowlight-actions {
            background: rgba(255, 255, 255, 0.2);
        }

        .lowlight-action-title {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #e74c3c;
        }

        .lowlight-alert.critical .lowlight-action-title {
            color: white;
        }

        .lowlight-action-steps {
            font-size: 10px;
            line-height: 1.4;
            color: #555;
        }

        .lowlight-alert.critical .lowlight-action-steps {
            color: rgba(255, 255, 255, 0.9);
        }

        /* 工作人天核实提醒 - 优化样式 */
        .workday-alert {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cc 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.15);
            position: relative;
            overflow: hidden;
        }

        .workday-alert::before {
            content: '🔍';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 60px;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .workday-alert.high-severity {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            border-color: #ff6b35;
        }

        .workday-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(243, 156, 18, 0.2);
        }

        .workday-alert.high-severity .workday-header {
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }

        .workday-title {
            font-size: 16px;
            font-weight: 600;
            color: #f39c12;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workday-alert.high-severity .workday-title {
            color: white;
        }

        .workday-severity {
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .workday-alert.high-severity .workday-severity {
            background: #ff6b35;
        }

        .workday-content {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: start;
        }

        .workday-info {
            flex: 1;
        }

        .workday-employee {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .workday-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .workday-alert.high-severity .workday-details {
            color: rgba(255, 255, 255, 0.8);
        }

        .workday-actions {
            background: rgba(243, 156, 18, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
        }

        .workday-alert.high-severity .workday-actions {
            background: rgba(255, 255, 255, 0.2);
        }

        .workday-action-title {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #f39c12;
        }

        .workday-alert.high-severity .workday-action-title {
            color: white;
        }

        .workday-action-steps {
            font-size: 10px;
            line-height: 1.4;
            color: #555;
        }

        .workday-alert.high-severity .workday-action-steps {
            color: rgba(255, 255, 255, 0.9);
        }

        /* 关键问题提醒横幅 */
        .critical-alerts-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(238, 90, 82, 0.3);
            border: 2px solid #ff4757;
        }

        .banner-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .banner-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .banner-stats {
            display: flex;
            gap: 15px;
            font-size: 14px;
        }

        .banner-stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .banner-content {
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.95;
        }

        .banner-actions {
            margin-top: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .stat-tag.good {
            background: #d4edda;
            color: #155724;
        }

        .stat-tag.warning {
            background: #fff3cd;
            color: #856404;
        }

        .stat-tag.danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* 行动建议样式 */
        .action-item {
            background: #ffffff;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #007bff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .action-item.critical {
            border-left-color: #e74c3c;
            background: #fff5f5;
        }

        .action-item.important {
            border-left-color: #f39c12;
            background: #fffbf0;
        }

        .action-item.recommendation {
            border-left-color: #27ae60;
            background: #f0fff4;
        }

        .action-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .action-description {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.4;
        }

        .action-metric {
            display: inline-block;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 6px;
            margin-right: 6px;
        }

        /* 问题高亮样式 */
        .problem-highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
        }

        .problem-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 4px;
        }

        .problem-value {
            font-size: 18px;
            font-weight: 700;
            color: #d68910;
        }

        /* 改进建议区块 */
        .suggestions-block {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #007bff;
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .suggestion-icon {
            font-size: 18px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .suggestion-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
            color: #495057;
        }

        .suggestion-text strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 2px;
        }

        /* 等级分布样式 */
        .grade-overview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .grade-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .grade-summary-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
            background: white;
        }

        .grade-summary-item.grade-S {
            border-color: #27ae60;
            color: #27ae60;
        }

        .grade-summary-item.grade-A {
            border-color: #3498db;
            color: #3498db;
        }

        .grade-summary-item.grade-B {
            border-color: #f39c12;
            color: #f39c12;
        }

        .grade-summary-item.grade-C {
            border-color: #e67e22;
            color: #e67e22;
        }

        .grade-summary-item.grade-D {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .grade-count-number {
            font-size: 24px;
            font-weight: 700;
            display: block;
            margin-bottom: 5px;
        }

        .grade-count-label {
            font-size: 14px;
            font-weight: 500;
        }

        .grade-bars {
            margin-top: 20px;
        }

        .grade-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .grade-bar-label {
            width: 60px;
            font-weight: 600;
            font-size: 14px;
        }

        .grade-bar-container {
            flex: 1;
            height: 24px;
            background: #e9ecef;
            border-radius: 12px;
            margin: 0 15px;
            overflow: hidden;
            position: relative;
        }

        .grade-bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .grade-bar-fill.grade-S {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .grade-bar-fill.grade-A {
            background: linear-gradient(135deg, #3498db, #5dade2);
        }

        .grade-bar-fill.grade-B {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
        }

        .grade-bar-fill.grade-C {
            background: linear-gradient(135deg, #e67e22, #d68910);
        }

        .grade-bar-fill.grade-D {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .grade-bar-percentage {
            width: 50px;
            text-align: right;
            font-weight: 600;
            font-size: 14px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .explanation {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }

        .explanation-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            text-align: left;
            line-height: 1.3;
        }

        .explanation-column {
            padding: 6px 8px;
            border-radius: 5px;
            background: #f8f9fa;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }

        .explanation-column:hover {
            background: #e9ecef;
            white-space: normal;
            overflow: visible;
            position: relative;
            z-index: 1;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }

        .success-message {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1024px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .upload-section,
            .results-section {
                padding: 20px;
            }

            .results-table {
                font-size: 0.8em;
            }

            .results-table th,
            .results-table td {
                padding: 6px 4px;
            }

            .col-name,
            .col-overdue-ratio,
            .col-overdue-days,
            .col-work-days,
            .col-score,
            .col-grade {
                min-width: 80px;
            }

            .col-explanation {
                min-width: 300px;
            }

            .explanation-columns {
                grid-template-columns: 1fr;
                gap: 4px;
            }

            .explanation-column {
                padding: 3px 4px;
                font-size: 0.8em;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.3;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .upload-section,
            .results-section {
                padding: 15px;
            }

            .results-table {
                font-size: 0.7em;
            }

            .results-table th,
            .results-table td {
                padding: 4px 2px;
            }

            .col-name,
            .col-overdue-ratio,
            .col-overdue-days,
            .col-work-days,
            .col-score,
            .col-grade {
                min-width: 60px;
            }

            .col-explanation {
                min-width: 250px;
            }

            .explanation-columns {
                grid-template-columns: 1fr;
                gap: 3px;
            }

            .explanation-column {
                padding: 2px 3px;
                font-size: 0.7em;
            }
        }

        /* 警告消息样式 */
        .warning-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .warning-icon {
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .warning-text {
            flex: 1;
            font-size: 0.9em;
            color: #856404;
            line-height: 1.4;
        }

        .warning-close {
            cursor: pointer;
            font-size: 1.1em;
            color: #856404;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .warning-close:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>研发团队效能评分系统</h1>
            <p>基于Python评分算法的网页版 - 支持文件上传和实时分析</p>
        </div>

        <div class="upload-section">
            <div class="upload-grid">
                <div class="upload-box" id="overdue-box">
                    <label for="overdue-file" class="upload-label">
                        📊 逾期比例数据
                    </label>
                    <input type="file" id="overdue-file" accept=".data,.txt" onchange="handleFileSelect('overdue', this)">
                    <div class="file-info" id="overdue-info">点击选择文件</div>
                </div>

                <div class="upload-box" id="mean-overdue-box">
                    <label for="mean-overdue-file" class="upload-label">
                        ⏰ 逾期天数数据
                    </label>
                    <input type="file" id="mean-overdue-file" accept=".data,.txt" onchange="handleFileSelect('mean-overdue', this)">
                    <div class="file-info" id="mean-overdue-info">点击选择文件</div>
                </div>

                <div class="upload-box" id="days-box">
                    <label for="days-file" class="upload-label">
                        💼 工作人天数据
                    </label>
                    <input type="file" id="days-file" accept=".data,.txt" onchange="handleFileSelect('days', this)">
                    <div class="file-info" id="days-info">点击选择文件</div>
                </div>
            </div>

            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>正在处理数据...</div>
            </div>

            <!-- 快捷上传：文件夹上传 -->
            <div class="quick-upload-separator">
                <span>或者</span>
            </div>

            <div class="folder-upload-section" id="folder-upload">
                <label for="folder-input" class="folder-upload-label">
                    <span>📁</span>
                    <span>快捷上传：选择文件夹</span>
                </label>
                <input type="file" id="folder-input" class="folder-upload-input" webkitdirectory directory multiple onchange="handleFolderUpload(this)">
                <div class="folder-upload-description">
                    系统将自动查找并解析默认文件：<br>
                    <strong>overdue.data</strong>（逾期比例）、<strong>mean_overdue.data</strong>（逾期天数）、<strong>days.data</strong>（工作人天）
                </div>
                <div class="folder-status" id="folder-status">点击选择包含数据文件的文件夹</div>

                <div class="batch-file-list" id="batch-file-list">
                    <div class="batch-file-item">
                        <span class="batch-file-name">overdue.data</span>
                        <span class="batch-file-status file-status-missing" id="file-status-overdue">未找到</span>
                    </div>
                    <div class="batch-file-item">
                        <span class="batch-file-name">mean_overdue.data</span>
                        <span class="batch-file-status file-status-missing" id="file-status-mean-overdue">未找到</span>
                    </div>
                    <div class="batch-file-item">
                        <span class="batch-file-name">days.data</span>
                        <span class="batch-file-status file-status-missing" id="file-status-days">未找到</span>
                    </div>
                </div>
            </div>

            <button class="process-btn" id="process-btn" onclick="processFiles()" disabled>
                开始分析
            </button>
        </div>

        <div class="results-section" id="results-section">
            <div class="results-header">
                <h2>评分结果</h2>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('table')" id="table-view-btn">表格视图</button>
                    <button class="view-btn" onclick="switchView('analysis')" id="analysis-view-btn">分析报告</button>
                </div>
                <button class="export-btn" onclick="exportToCSV()">导出CSV</button>
            </div>

            <div class="results-table-container">
                <table class="results-table" id="results-table">
                    <thead>
                        <tr>
                            <th class="col-rank">排名</th>
                            <th class="col-name">姓名</th>
                            <th class="col-overdue-ratio">逾期比例</th>
                            <th class="col-overdue-days">逾期天数</th>
                            <th class="col-work-days">工作人天</th>
                            <th class="col-score">综合得分</th>
                            <th class="col-grade">等级</th>
                            <th class="col-explanation">说明</th>
                        </tr>
                    </thead>
                    <tbody id="results-tbody">
                    </tbody>
                </table>
            </div>

            <div class="stats-grid" id="stats-grid">
            </div>

            <!-- 分析报告容器 -->
            <div class="analysis-report" id="analysis-report" style="display: none;">
                <div class="report-header">
                    <h1>研发团队效能评分分析报告 (优化版v2.3)</h1>
                </div>

                <!-- 关键问题提醒横幅 -->
                <div id="critical-alerts-banner" style="display: none;">
                </div>

                <!-- 基础统计 -->
                <div class="analysis-section">
                    <h3>📊 基础统计</h3>
                    <div class="stats-overview" id="stats-overview">
                        <div class="stats-compact">
                            <div class="stat-item">
                                <span class="stat-label">总评估人数</span>
                                <span class="stat-value" id="total-people">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">平均综合得分</span>
                                <span class="stat-value" id="avg-score">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">得分中位数</span>
                                <span class="stat-value" id="median-score">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">分数区间</span>
                                <span class="stat-value" id="score-range">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 等级分布 -->
                <div class="analysis-section">
                    <h3>🏆 等级分布 (S≥85, A≥70, B≥55, C≥40)</h3>
                    <div class="grade-distribution" id="grade-distribution">
                        <div class="grade-overview">
                            <div class="grade-summary" id="grade-summary">
                                <!-- 总体统计将在这里显示 -->
                            </div>
                            <div class="grade-bars" id="grade-bars">
                                <!-- 等级条形图将在这里显示 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 逾期问题分析 -->
                <div class="analysis-section">
                    <h3>⏰ 逾期问题分析</h3>
                    <div class="overdue-analysis" id="overdue-analysis">
                        <div class="stats-compact">
                            <div class="stat-item">
                                <span class="stat-label">平均逾期比例</span>
                                <span class="stat-value" id="avg-overdue-ratio">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">平均逾期天数</span>
                                <span class="stat-value" id="avg-overdue-days">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">严重逾期(>50%)</span>
                                <span class="stat-value" id="serious-overdue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">长期逾期(>5天)</span>
                                <span class="stat-value" id="long-overdue">-</span>
                            </div>
                        </div>
                        <!-- 问题高亮区域 -->
                        <div id="overdue-problems" style="margin-top: 16px;">
                            <!-- 动态生成问题高亮 -->
                        </div>
                    </div>
                </div>

                <!-- 工作量分析 -->
                <div class="analysis-section">
                    <h3>💼 工作量分析 (新评分标准：人天越多越好)</h3>
                    <div class="workload-analysis" id="workload-analysis">
                        <!-- 核心指标 -->
                        <div class="stats-compact" style="margin-bottom: 16px;">
                            <div class="stat-item">
                                <span class="stat-label">平均工作人天</span>
                                <span class="stat-value" id="avg-work-days">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">人天中位数</span>
                                <span class="stat-value" id="median-work-days">-</span>
                            </div>
                        </div>
                        <!-- 分布情况 -->
                        <div class="stats-compact">
                            <div class="stat-item">
                                <span class="stat-label">工作量不足(<8人天)</span>
                                <span class="stat-value" id="insufficient-work">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">理想区间(8-10人天)</span>
                                <span class="stat-value" id="ideal-work">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">优秀表现(10-15人天)</span>
                                <span class="stat-value" id="excellent-work">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">超高产出(>15人天)</span>
                                <span class="stat-value" id="high-work">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Highlight候选 -->
                <div class="analysis-section">
                    <h3>🌟 Highlight候选 (S级 ≥85分)</h3>
                    <div class="highlight-candidates" id="highlight-employees">
                    </div>
                </div>

                <!-- Lowlight需关注 -->
                <div class="analysis-section">
                    <h3>⚠️ Lowlight需关注 (D级 <40分)</h3>
                    <div class="lowlight-concerns" id="lowlight-employees">
                    </div>
                </div>

                <!-- 需核实人天记录 -->
                <div class="analysis-section">
                    <h3>🔍 需核实人天记录 (>15人天)</h3>
                    <div class="review-needed" id="review-employees">
                    </div>
                </div>

                <!-- 团队改进建议 -->
                <div class="analysis-section">
                    <h3>💡 团队改进建议</h3>
                    <div class="suggestions-block">
                        <div class="improvement-suggestions" id="team-suggestions">
                            <!-- 建议将在这里动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let fileData = {
            overdue: null,
            meanOverdue: null,
            days: null
        };

        // 文件选择处理
        function handleFileSelect(type, input) {
            const file = input.files[0];
            if (!file) return;

            const box = document.getElementById(type + '-box');
            const info = document.getElementById(type + '-info');

            box.classList.add('has-file');
            info.textContent = `已选择: ${file.name}`;

            const reader = new FileReader();
            reader.onload = function(e) {
                fileData[type === 'mean-overdue' ? 'meanOverdue' : type] = e.target.result;
                checkAllFilesLoaded();
            };
            reader.readAsText(file, 'UTF-8');
        }

        // 文件夹上传处理
        async function handleFolderUpload(input) {
            const files = Array.from(input.files);
            const folderSection = document.getElementById('folder-upload');
            const folderStatus = document.getElementById('folder-status');

            if (files.length === 0) {
                showError('未选择文件夹或文件夹为空');
                return;
            }

            folderStatus.textContent = '正在扫描文件夹...';

            // 重置文件状态
            const defaultFiles = {
                'overdue.data': false,
                'mean_overdue.data': false,
                'days.data': false
            };

            // 扫描文件
            for (const file of files) {
                if (defaultFiles.hasOwnProperty(file.name)) {
                    defaultFiles[file.name] = file;
                    console.log(`Found default file: ${file.name}`);
                }
            }

            // 更新UI状态
            let foundFiles = 0;
            for (const [fileName, fileObj] of Object.entries(defaultFiles)) {
                const statusElement = document.getElementById(`file-status-${fileName.replace('.data', '').replace('_overdue', '-overdue')}`);

                if (fileObj !== false) {
                    statusElement.textContent = '已找到';
                    statusElement.className = 'batch-file-status file-status-found';
                    foundFiles++;
                } else {
                    statusElement.textContent = '未找到';
                    statusElement.className = 'batch-file-status file-status-missing';
                }
            }

            // 如果找到所有文件，自动加载
            if (foundFiles === 3) {
                folderSection.classList.add('has-folder');
                folderStatus.textContent = '✅ 找到所有默认文件，正在自动加载...';

                // 清除之前的文件数据
                fileData.overdue = null;
                fileData.meanOverdue = null;
                fileData.days = null;

                // 读取文件内容
                try {
                    await loadFileContent(defaultFiles['overdue.data'], 'overdue');
                    await loadFileContent(defaultFiles['mean_overdue.data'], 'mean-overdue');
                    await loadFileContent(defaultFiles['days.data'], 'days');

                    folderStatus.textContent = '✅ 所有文件加载完成！';
                    showSuccess('文件夹上传成功：已自动加载3个数据文件');

                } catch (error) {
                    showError('文件加载失败：' + error.message);
                    folderSection.classList.remove('has-folder');
                    folderStatus.textContent = '❌ 文件加载失败';
                }
            } else {
                folderSection.classList.add('has-folder');
                folderStatus.textContent = `⚠️ 找到 ${foundFiles}/3 个文件，请手动上传缺失文件`;
                showWarning(`文件夹扫描完成：找到 ${foundFiles}/3 个默认文件`);
            }
        }

        // 显示警告信息
        function showWarning(message) {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'warning-message';
            warningDiv.innerHTML = `
                <div class="warning-icon">⚠️</div>
                <div class="warning-text">${message}</div>
                <div class="warning-close" onclick="this.parentElement.remove()">✕</div>
            `;
            document.body.appendChild(warningDiv);

            // 5秒后自动消失
            setTimeout(() => {
                if (warningDiv.parentElement) {
                    warningDiv.remove();
                }
            }, 5000);
        }

        // 加载文件内容的辅助函数
        function loadFileContent(file, type) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileData[type === 'mean-overdue' ? 'meanOverdue' : type] = e.target.result;
                    checkAllFilesLoaded();
                    resolve();
                };
                reader.onerror = function() {
                    reject(new Error(`读取文件 ${file.name} 失败`));
                };
                reader.readAsText(file, 'UTF-8');
            });
        }

        // 检查所有文件是否已加载
        function checkAllFilesLoaded() {
            const btn = document.getElementById('process-btn');
            if (fileData.overdue && fileData.meanOverdue && fileData.days) {
                btn.disabled = false;
                btn.textContent = '开始分析';
            } else {
                btn.disabled = true;
                btn.textContent = '请上传所有文件';
            }
        }

        // 显示错误信息
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // 显示成功信息
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // 数据解析器
        class DataParser {
            static parseOverdueData(content) {
                const data = {};
                const lines = content.split('\n').filter(line => line.trim());

                console.log('Overdue data lines:', lines.length);

                for (let i = 0; i < lines.length; i += 3) {
                    if (i + 2 < lines.length) {
                        const name = lines[i].trim();
                        const ratioStr = lines[i + 1].trim();
                        const ratio = parseFloat(ratioStr.replace('%', ''));
                        if (!isNaN(ratio) && name) {
                            data[name] = ratio;
                            console.log(`Overdue: ${name} = ${ratio}%`);
                        }
                    }
                }
                console.log('Overdue data parsed:', Object.keys(data).length, 'entries');
                return data;
            }

            static parseMeanOverdueData(content) {
                const data = {};
                const lines = content.split('\n').filter(line => line.trim());

                console.log('Mean overdue data lines:', lines.length);

                for (let i = 0; i < lines.length; i += 3) {
                    if (i + 2 < lines.length) {
                        const name = lines[i].trim();
                        const days = parseFloat(lines[i + 1].trim());
                        if (!isNaN(days) && name) {
                            data[name] = days;
                            console.log(`Mean overdue: ${name} = ${days} days`);
                        }
                    }
                }
                console.log('Mean overdue data parsed:', Object.keys(data).length, 'entries');
                return data;
            }

            static parseDaysData(content) {
                const data = {};
                const lines = content.split('\n').filter(line => line.trim());

                console.log('Days data lines:', lines.length);

                for (let i = 0; i < lines.length; i += 5) {
                    if (i + 4 < lines.length) {
                        const name = lines[i].trim();
                        const workDays = parseFloat(lines[i + 1].trim());
                        if (!isNaN(workDays) && name) {
                            data[name] = workDays;
                            console.log(`Days: ${name} = ${workDays} work days`);
                        }
                    }
                }
                console.log('Days data parsed:', Object.keys(data).length, 'entries');
                return data;
            }

            static validateData(overdueData, meanOverdueData, daysData) {
                if (!overdueData || !meanOverdueData || !daysData) {
                    return { valid: false, message: "存在空数据集" };
                }

                console.log('Data validation:');
                console.log('- Overdue entries:', Object.keys(overdueData).length);
                console.log('- Mean overdue entries:', Object.keys(meanOverdueData).length);
                console.log('- Days entries:', Object.keys(daysData).length);

                const overdueNames = new Set(Object.keys(overdueData));
                const meanOverdueNames = new Set(Object.keys(meanOverdueData));
                const daysNames = new Set(Object.keys(daysData));

                const commonNames = new Set([...overdueNames].filter(name =>
                    meanOverdueNames.has(name) && daysNames.has(name)
                ));

                console.log('- Common names:', commonNames.size);
                console.log('- Names in all three datasets:', Array.from(commonNames).sort());

                if (commonNames.size === 0) {
                    return { valid: false, message: "三个数据集没有共同的员工姓名" };
                }

                // 检查数据范围
                for (const [name, ratio] of Object.entries(overdueData)) {
                    if (ratio < 0 || ratio > 100) {
                        return { valid: false, message: `逾期比例数据异常: ${name} = ${ratio}%` };
                    }
                }

                for (const [name, days] of Object.entries(meanOverdueData)) {
                    if (days < 0) {
                        return { valid: false, message: `逾期天数数据异常: ${name} = ${days}天` };
                    }
                }

                for (const [name, workDays] of Object.entries(daysData)) {
                    if (workDays < 0) {
                        return { valid: false, message: `工作人天数据异常: ${name} = ${workDays}人天` };
                    }
                }

                return { valid: true, message: `数据验证通过，共${commonNames.size}名员工` };
            }
        }

        // 评分计算器
        class ScoringCalculator {
            constructor() {
                this.config = {
                    weights: {
                        overdue_ratio: 0.4,
                        overdue_days: 0.4,
                        work_days: 0.2
                    },
                    overdue_ratio_params: {
                        baseline: 20.0,
                        multiplier: 2.0,
                        max_score: 100,
                        min_score: 0
                    },
                    overdue_days_params: {
                        baseline: 2.0,
                        multiplier: 15,
                        max_score: 100,
                        min_score: 0
                    },
                    work_days_params: {
                        standard_days: 10,
                        bonus_tier1_max: 15,
                        bonus_tier1_rate: 2,
                        bonus_tier2_rate: 1,
                        bonus_tier3_max: 20,
                        bonus_tier3_rate: 0.5,
                        base_penalty_rate: 5,
                        progressive_multiplier: 1.2,
                        max_score: 130,
                        min_score: 20,
                        inflation_threshold: 15,
                        overload_threshold: 20
                    },
                    grade_thresholds: {
                        S: 85,
                        A: 70,
                        B: 55,
                        C: 40
                    }
                };
            }

            calculateOverdueRatioScore(ratio) {
                const params = this.config.overdue_ratio_params;
                const score = params.max_score - Math.max(0, ratio - params.baseline) * params.multiplier;
                return Math.max(params.min_score, Math.min(params.max_score, score));
            }

            calculateOverdueDaysScore(days) {
                const params = this.config.overdue_days_params;
                const baseline = params.baseline;

                if (days <= baseline) {
                    return params.max_score;
                }

                const buffer = 2.0;
                const score = params.max_score * (baseline + buffer) / (days + buffer);
                return Math.max(params.min_score, Math.round(score * 100) / 100);
            }

            calculateProgressivePenalty(days, standardDays, basePenaltyRate, multiplier) {
                if (days >= standardDays) {
                    return 0;
                }

                const gap = standardDays - days;
                const penaltyFactor = basePenaltyRate * Math.pow(multiplier, gap - 1);
                const totalPenalty = penaltyFactor * gap;
                return totalPenalty;
            }

            calculateWorkDaysScore(days) {
                const params = this.config.work_days_params;
                const standardDays = params.standard_days;

                if (days < standardDays) {
                    const penalty = this.calculateProgressivePenalty(
                        days,
                        standardDays,
                        params.base_penalty_rate,
                        params.progressive_multiplier
                    );
                    const score = 100 - penalty;
                    return Math.max(params.min_score, score);
                } else if (days === standardDays) {
                    return 100;
                } else if (standardDays < days && days <= params.bonus_tier1_max) {
                    const bonusDays = days - standardDays;
                    const score = 100 + bonusDays * params.bonus_tier1_rate;
                    return Math.min(params.max_score, score);
                } else if (params.bonus_tier1_max < days && days <= params.bonus_tier3_max) {
                    const tier1Bonus = (params.bonus_tier1_max - standardDays) * params.bonus_tier1_rate;
                    const tier2Bonus = (days - params.bonus_tier1_max) * params.bonus_tier2_rate;
                    const score = 100 + tier1Bonus + tier2Bonus;
                    return Math.min(params.max_score, score);
                } else {
                    const tier1Bonus = (params.bonus_tier1_max - standardDays) * params.bonus_tier1_rate;
                    const tier2Bonus = (params.bonus_tier3_max - params.bonus_tier1_max) * params.bonus_tier2_rate;
                    const tier3Bonus = (days - params.bonus_tier3_max) * params.bonus_tier3_rate;
                    const score = 100 + tier1Bonus + tier2Bonus + tier3Bonus;
                    return Math.min(params.max_score, score);
                }
            }

            calculateComprehensiveScore(overdueRatio, overdueDays, workDays) {
                const ratioScore = this.calculateOverdueRatioScore(overdueRatio);
                const daysScore = this.calculateOverdueDaysScore(overdueDays);
                const workDaysScore = this.calculateWorkDaysScore(workDays);

                const weights = this.config.weights;
                const comprehensiveScore = (
                    ratioScore * weights.overdue_ratio +
                    daysScore * weights.overdue_days +
                    workDaysScore * weights.work_days
                );

                return {
                    overdue_ratio_score: Math.round(ratioScore * 100) / 100,
                    overdue_days_score: Math.round(daysScore * 100) / 100,
                    work_days_score: Math.round(workDaysScore * 100) / 100,
                    comprehensive_score: Math.round(comprehensiveScore * 100) / 100
                };
            }

            getGrade(score) {
                const thresholds = this.config.grade_thresholds;
                if (score >= thresholds.S) return "S";
                if (score >= thresholds.A) return "A";
                if (score >= thresholds.B) return "B";
                if (score >= thresholds.C) return "C";
                return "D";
            }

            explainScore(overdueRatio, overdueDays, workDays) {
                const params = this.config.work_days_params;
                const explanation = [];

                if (overdueRatio <= 20) {
                    explanation.push(`✅ 逾期比例${overdueRatio.toFixed(1)}%表现良好`);
                } else {
                    explanation.push(`⚠️ 逾期比例${overdueRatio.toFixed(1)}%超出基准(20%)`);
                }

                if (overdueDays <= 2) {
                    explanation.push(`✅ 逾期天数${overdueDays.toFixed(1)}天控制良好`);
                } else {
                    explanation.push(`⚠️ 逾期天数${overdueDays.toFixed(1)}天超出基准(2天)`);
                }

                const standardDays = params.standard_days;
                if (workDays < standardDays) {
                    explanation.push(`📉 工作量${workDays.toFixed(1)}人天不足(标准${standardDays}人天)`);
                } else if (workDays === standardDays) {
                    explanation.push(`✅ 工作量${workDays.toFixed(1)}人天标准`);
                } else if (standardDays < workDays && workDays <= params.bonus_tier1_max) {
                    explanation.push(`💪 工作量${workDays.toFixed(1)}人天优秀`);
                } else {
                    if (workDays > params.inflation_threshold) {
                        explanation.push(`🔥 工作量${workDays.toFixed(1)}人天超高⚠️需核实人天记录`);
                    } else {
                        explanation.push(`🔥 工作量${workDays.toFixed(1)}人天超高`);
                    }
                }

                return explanation;
            }

            needsReview(workDays) {
                return workDays > this.config.work_days_params.inflation_threshold;
            }
        }

        // 处理文件
        async function processFiles() {
            const loading = document.getElementById('loading');
            const btn = document.getElementById('process-btn');

            loading.style.display = 'block';
            btn.disabled = true;

            try {
                // 解析数据
                const overdueData = DataParser.parseOverdueData(fileData.overdue);
                const meanOverdueData = DataParser.parseMeanOverdueData(fileData.meanOverdue);
                const daysData = DataParser.parseDaysData(fileData.days);

                // 验证数据
                const validation = DataParser.validateData(overdueData, meanOverdueData, daysData);
                if (!validation.valid) {
                    showError(validation.message);
                    return;
                }

                showSuccess(validation.message);

                // 计算评分
                const calculator = new ScoringCalculator();
                const results = [];

                const overdueNames = new Set(Object.keys(overdueData));
                const meanOverdueNames = new Set(Object.keys(meanOverdueData));
                const daysNames = new Set(Object.keys(daysData));

                const commonNames = Array.from(overdueNames).filter(name =>
                    meanOverdueNames.has(name) && daysNames.has(name)
                );

                console.log('Processing data for', commonNames.length, 'employees');
                console.log('Common names:', commonNames.sort());

                for (const name of commonNames) {
                    const scores = calculator.calculateComprehensiveScore(
                        overdueData[name],
                        meanOverdueData[name],
                        daysData[name]
                    );

                    const grade = calculator.getGrade(scores.comprehensive_score);
                    const explanation = calculator.explainScore(
                        overdueData[name],
                        meanOverdueData[name],
                        daysData[name]
                    );
                    const needsReview = calculator.needsReview(daysData[name]);

                    results.push({
                        name,
                        overdue_ratio: overdueData[name],
                        overdue_days: meanOverdueData[name],
                        work_days: daysData[name],
                        ...scores,
                        grade,
                        explanation,
                        needs_review: needsReview
                    });
                }

                // 排序结果
                results.sort((a, b) => b.comprehensive_score - a.comprehensive_score);

                // 显示结果
                displayResults(results);
                showSuccess(`分析完成！共处理${results.length}名员工数据`);

            } catch (error) {
                showError(`处理过程中出错: ${error.message}`);
            } finally {
                loading.style.display = 'none';
                btn.disabled = false;
            }
        }

        // 显示结果
        function displayResults(results) {
            const resultsSection = document.getElementById('results-section');
            const tbody = document.getElementById('results-tbody');
            const statsGrid = document.getElementById('stats-grid');

            // 清空现有内容
            tbody.innerHTML = '';
            statsGrid.innerHTML = '';

            // 填充表格
            results.forEach((result, index) => {
                const row = document.createElement('tr');

                // 创建三列说明
                const explanationHtml = Array.isArray(result.explanation)
                    ? `
                        <div class="explanation-columns">
                            <div class="explanation-column">${result.explanation[0] || ''}</div>
                            <div class="explanation-column">${result.explanation[1] || ''}</div>
                            <div class="explanation-column">${result.explanation[2] || ''}</div>
                        </div>
                    `
                    : `<div class="explanation">${result.explanation}</div>`;

                row.innerHTML = `
                    <td class="col-rank">${index + 1}</td>
                    <td class="col-name">${result.name}</td>
                    <td class="col-overdue-ratio">${result.overdue_ratio.toFixed(1)}%</td>
                    <td class="col-overdue-days">${result.overdue_days.toFixed(1)}天</td>
                    <td class="col-work-days">${result.work_days.toFixed(1)}人天</td>
                    <td class="col-score">${result.comprehensive_score}</td>
                    <td class="col-grade"><span class="grade grade-${result.grade}">${result.grade}</span></td>
                    <td class="col-explanation">${explanationHtml}</td>
                `;
                tbody.appendChild(row);
            });

            // 计算统计信息
            const stats = calculateStatistics(results);

            // 显示统计卡片
            const statCards = [
                { label: '总人数', value: stats.totalPeople },
                { label: '平均得分', value: stats.averageScore.toFixed(1) + '分' },
                { label: '最高分', value: stats.maxScore + '分' },
                { label: '最低分', value: stats.minScore + '分' },
                { label: 'S级人数', value: stats.gradeDistribution.S + '人' },
                { label: '需核实人天', value: stats.needsReviewCount + '人' }
            ];

            statCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'stat-card';
                cardDiv.innerHTML = `
                    <div class="stat-value">${card.value}</div>
                    <div class="stat-label">${card.label}</div>
                `;
                statsGrid.appendChild(cardDiv);
            });

            // 保存结果用于导出
            window.currentResults = results;

            // 显示结果区域
            resultsSection.style.display = 'block';

            // 初始化视图状态 - 确保表格视图显示，其他视图隐藏
            switchView('table');

            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // 计算统计信息
        function calculateStatistics(results) {
            const totalPeople = results.length;
            const scores = results.map(r => r.comprehensive_score);
            const averageScore = scores.reduce((a, b) => a + b, 0) / totalPeople;
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);

            const gradeDistribution = { S: 0, A: 0, B: 0, C: 0, D: 0 };
            results.forEach(r => {
                gradeDistribution[r.grade]++;
            });

            const needsReviewCount = results.filter(r => r.needs_review).length;

            return {
                totalPeople,
                averageScore,
                maxScore,
                minScore,
                gradeDistribution,
                needsReviewCount
            };
        }

        // 导出CSV
        function exportToCSV() {
            if (!window.currentResults || window.currentResults.length === 0) {
                showError('没有数据可导出');
                return;
            }

            const results = window.currentResults;
            const headers = ['排名', '姓名', '逾期比例', '逾期天数', '工作人天', '综合得分', '等级', '说明'];

            const csvContent = [
                headers.join(','),
                ...results.map((result, index) => [
                    index + 1,
                    result.name,
                    result.overdue_ratio.toFixed(1) + '%',
                    result.overdue_days.toFixed(1) + '天',
                    result.work_days.toFixed(1) + '人天',
                    result.comprehensive_score,
                    result.grade,
                    `"${result.explanation}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `团队效能评分_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showSuccess('CSV文件已导出');
        }

        // 切换视图
        function switchView(viewType) {
            const tableView = document.querySelector('.results-table-container');
            const statsGrid = document.querySelector('.stats-grid');
            const analysisReport = document.querySelector('.analysis-report');

            // 管理按钮状态
            const tableBtn = document.getElementById('table-view-btn');
            const analysisBtn = document.getElementById('analysis-view-btn');

            // 移除所有按钮的active状态
            tableBtn.classList.remove('active');
            analysisBtn.classList.remove('active');

            // 隐藏所有视图
            tableView.style.display = 'none';
            statsGrid.style.display = 'none';
            analysisReport.style.display = 'none';

            // 显示选中的视图并设置对应按钮为active
            switch(viewType) {
                case 'table':
                    tableView.style.display = 'block';
                    tableBtn.classList.add('active');
                    break;
                case 'stats':
                    statsGrid.style.display = 'grid';
                    break;
                case 'analysis':
                    analysisReport.style.display = 'block';
                    analysisBtn.classList.add('active');
                    generateAnalysisReport();
                    break;
            }
        }

        // 生成分析报告
        function generateAnalysisReport() {
            if (!window.currentResults || window.currentResults.length === 0) {
                showError('没有数据可分析');
                return;
            }

            const results = window.currentResults;

            // 基础统计
            const totalPeople = results.length;
            const avgScore = results.reduce((sum, r) => sum + r.comprehensive_score, 0) / totalPeople;
            const medianScore = getMedian(results.map(r => r.comprehensive_score));
            const minScore = Math.min(...results.map(r => r.comprehensive_score));
            const maxScore = Math.max(...results.map(r => r.comprehensive_score));

            // 等级分布
            const gradeCount = {};
            results.forEach(r => {
                gradeCount[r.grade] = (gradeCount[r.grade] || 0) + 1;
            });

            // 逾期分析
            const avgOverdueRatio = results.reduce((sum, r) => sum + r.overdue_ratio, 0) / totalPeople;
            const avgOverdueDays = results.reduce((sum, r) => sum + r.overdue_days, 0) / totalPeople;
            const seriousOverdue = results.filter(r => r.overdue_ratio > 50).length;
            const longOverdue = results.filter(r => r.overdue_days > 5).length;

            // 工作量分析
            const avgWorkDays = results.reduce((sum, r) => sum + r.work_days, 0) / totalPeople;
            const medianWorkDays = getMedian(results.map(r => r.work_days));
            const insufficientWork = results.filter(r => r.work_days < 8).length;
            const idealWork = results.filter(r => r.work_days >= 8 && r.work_days <= 10).length;
            const excellentWork = results.filter(r => r.work_days > 10 && r.work_days <= 15).length;
            const highWork = results.filter(r => r.work_days > 15).length;

            // 更新基础统计
            const totalPeopleEl = document.getElementById('total-people');
            const avgScoreEl = document.getElementById('avg-score');
            const medianScoreEl = document.getElementById('median-score');
            const scoreRangeEl = document.getElementById('score-range');

            totalPeopleEl.textContent = totalPeople;
            avgScoreEl.textContent = avgScore.toFixed(2) + '分';
            medianScoreEl.textContent = medianScore.toFixed(2) + '分';
            scoreRangeEl.textContent = `${minScore.toFixed(2)} - ${maxScore.toFixed(2)}分`;

            // 添加状态指示
            avgScoreEl.className = 'stat-value ' + (avgScore >= 70 ? 'good' : avgScore >= 55 ? 'warning' : 'danger');

            // 更新等级分布
            const sortedGrades = Object.entries(gradeCount)
                .sort(([a], [b]) => ['S', 'A', 'B', 'C', 'D'].indexOf(a) - ['S', 'A', 'B', 'C', 'D'].indexOf(b));

            // 生成等级汇总卡片
            const gradeSummaryHtml = sortedGrades.map(([grade, count]) => {
                const percentage = ((count / totalPeople) * 100).toFixed(1);
                return `<div class="grade-summary-item grade-${grade}">
                    <span class="grade-count-number">${count}</span>
                    <span class="grade-count-label">${grade}级 (${percentage}%)</span>
                </div>`;
            }).join('');

            // 生成等级条形图
            const gradeBarsHtml = sortedGrades.map(([grade, count]) => {
                const percentage = ((count / totalPeople) * 100).toFixed(1);
                const barWidth = Math.max(percentage, 8); // 最小宽度8%以保证可见性
                return `<div class="grade-bar-item">
                    <div class="grade-bar-label">${grade}级</div>
                    <div class="grade-bar-container">
                        <div class="grade-bar-fill grade-${grade}" style="width: ${barWidth}%">
                            ${percentage}%
                        </div>
                    </div>
                    <div class="grade-bar-percentage">${count}人</div>
                </div>`;
            }).join('');

            document.getElementById('grade-summary').innerHTML = gradeSummaryHtml;
            document.getElementById('grade-bars').innerHTML = gradeBarsHtml;

            // 更新逾期分析
            const avgOverdueRatioEl = document.getElementById('avg-overdue-ratio');
            const avgOverdueDaysEl = document.getElementById('avg-overdue-days');
            const seriousOverdueEl = document.getElementById('serious-overdue');
            const longOverdueEl = document.getElementById('long-overdue');

            avgOverdueRatioEl.textContent = avgOverdueRatio.toFixed(2) + '%';
            avgOverdueDaysEl.textContent = avgOverdueDays.toFixed(2) + '天';
            seriousOverdueEl.textContent = seriousOverdue + '人';
            longOverdueEl.textContent = longOverdue + '人';

            // 添加状态指示
            avgOverdueRatioEl.className = 'stat-value ' + (avgOverdueRatio <= 20 ? 'good' : avgOverdueRatio <= 35 ? 'warning' : 'danger');
            avgOverdueDaysEl.className = 'stat-value ' + (avgOverdueDays <= 2 ? 'good' : avgOverdueDays <= 5 ? 'warning' : 'danger');
            seriousOverdueEl.className = 'stat-value ' + (seriousOverdue === 0 ? 'good' : seriousOverdue <= 5 ? 'warning' : 'danger');
            longOverdueEl.className = 'stat-value ' + (longOverdue === 0 ? 'good' : longOverdue <= 10 ? 'warning' : 'danger');

            // 生成逾期问题高亮
            generateOverdueProblems({
                avgOverdueRatio,
                avgOverdueDays,
                seriousOverdue,
                longOverdue,
                totalPeople
            });

            // 更新工作量分析
            const avgWorkDaysEl = document.getElementById('avg-work-days');
            const medianWorkDaysEl = document.getElementById('median-work-days');
            const insufficientWorkEl = document.getElementById('insufficient-work');
            const idealWorkEl = document.getElementById('ideal-work');
            const excellentWorkEl = document.getElementById('excellent-work');
            const highWorkEl = document.getElementById('high-work');

            avgWorkDaysEl.textContent = avgWorkDays.toFixed(2) + '人天';
            medianWorkDaysEl.textContent = medianWorkDays.toFixed(2) + '人天';
            insufficientWorkEl.textContent = insufficientWork + '人';
            idealWorkEl.textContent = idealWork + '人';
            excellentWorkEl.textContent = excellentWork + '人';
            highWorkEl.textContent = highWork + '人';

            // 添加状态指示
            avgWorkDaysEl.className = 'stat-value info';
            medianWorkDaysEl.className = 'stat-value info';
            insufficientWorkEl.className = 'stat-value ' + (insufficientWork === 0 ? 'good' : insufficientWork <= 5 ? 'warning' : 'danger');
            idealWorkEl.className = 'stat-value ' + (idealWork >= totalPeople * 0.3 ? 'good' : idealWork >= totalPeople * 0.2 ? 'warning' : 'info');
            excellentWorkEl.className = 'stat-value ' + (excellentWork >= totalPeople * 0.2 ? 'good' : 'info');
            highWorkEl.className = 'stat-value ' + (highWork === 0 ? 'good' : highWork <= 3 ? 'warning' : 'danger');

            // 更新Highlight候选 (S级)
            const highlightEmployees = results.filter(r => r.grade === 'S' && r.comprehensive_score >= 85);
            const highlightHtml = highlightEmployees.map(emp => `
                <div class="employee-card">
                    <div class="employee-header">
                        <span class="employee-name">${emp.name}</span>
                        <span class="employee-score">${emp.comprehensive_score.toFixed(2)}分</span>
                    </div>
                    <div class="employee-details">${emp.explanation}</div>
                </div>
            `).join('');
            document.getElementById('highlight-employees').innerHTML = highlightHtml || '<p>暂无Highlight候选</p>';

            // 更新Lowlight需关注 (D级) - 优化显示
            const lowlightEmployees = results.filter(r => r.grade === 'D' && r.comprehensive_score < 40);
            const lowlightHtml = lowlightEmployees.map(emp => {
                const isCritical = emp.comprehensive_score < 20; // 极低分数为严重级别
                const urgencyLevel = emp.comprehensive_score < 20 ? '严重' : '关注';
                const alertClass = isCritical ? 'critical' : '';

                return `
                <div class="lowlight-alert ${alertClass}">
                    <div class="lowlight-header">
                        <div class="lowlight-title">
                            <span>⚠️</span>
                            <span>Lowlight需关注</span>
                        </div>
                        <div class="lowlight-urgency">${urgencyLevel}级别</div>
                    </div>
                    <div class="lowlight-content">
                        <div class="lowlight-info">
                            <div class="lowlight-employee">${emp.name}</div>
                            <div class="lowlight-score">综合得分: ${emp.comprehensive_score.toFixed(2)}分 (D级)</div>
                            <div class="lowlight-score">${emp.explanation}</div>
                        </div>
                        <div class="lowlight-actions">
                            <div class="lowlight-action-title">🎯 改进建议</div>
                            <div class="lowlight-action-steps">
                                ${isCritical ?
                                    '1. 立即进行一对一绩效沟通<br>2. 制定明确的改进计划<br>3. 每日跟进进展情况<br>4. 考虑调整工作分配<br>5. 提供必要的培训支持' :
                                    '1. 安排绩效面谈了解情况<br>2. 分析逾期原因和障碍<br>3. 制定合理的改进目标<br>4. 加强过程监控和指导<br>5. 定期回顾改进效果'
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;}).join('');
            document.getElementById('lowlight-employees').innerHTML = lowlightHtml || '<p>暂无Lowlight需关注</p>';

            // 更新需核实人天记录 (>15人天) - 优化显示
            const reviewEmployees = results.filter(r => r.work_days > 15);
            const reviewHtml = reviewEmployees.map(emp => {
                const isHighSeverity = emp.work_days > 25; // 超高人天为高级别
                const severityLevel = emp.work_days > 25 ? '高级' : '中级';
                const alertClass = isHighSeverity ? 'high-severity' : '';

                return `
                <div class="workday-alert ${alertClass}">
                    <div class="workday-header">
                        <div class="workday-title">
                            <span>🔍</span>
                            <span>需核实人天记录</span>
                        </div>
                        <div class="workday-severity">${severityLevel}优先级</div>
                    </div>
                    <div class="workday-content">
                        <div class="workday-info">
                            <div class="workday-employee">${emp.name}</div>
                            <div class="workday-details">工作人天: ${emp.work_days.toFixed(1)}天 (综合得分: ${emp.comprehensive_score.toFixed(2)}分)</div>
                            <div class="workday-details">
                                ${isHighSeverity ?
                                    '⚠️ 人天记录异常偏高，可能存在以下问题：<br>• 工作量估算不准确<br>• 重复统计或记录错误<br>• 任务分解过细导致计数偏差<br>• 可能存在效率问题' :
                                    '⚠️ 人天记录偏高，建议核实以下方面：<br>• 工作量记录是否准确<br>• 是否存在重复统计<br>• 任务估算是否合理<br>• 工作效率是否需要优化'
                                }
                            </div>
                        </div>
                        <div class="workday-actions">
                            <div class="workday-action-title">📋 核实清单</div>
                            <div class="workday-action-steps">
                                ${isHighSeverity ?
                                    '1. 立即核查原始记录数据<br>2. 确认无重复统计情况<br>3. 重新评估任务工作量<br>4. 检查工作记录流程<br>5. 必要时调整历史数据' :
                                    '1. 核对工作记录原始数据<br>2. 确认无重复统计问题<br>3. 评估工作量估算合理性<br>4. 检查工作记录完整性<br>5. 优化工作记录流程'
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;}).join('');
            document.getElementById('review-employees').innerHTML = reviewHtml || '<p>暂无需核实的人天记录</p>';

            // 更新关键问题提醒横幅
            const criticalLowlightCount = results.filter(r => r.grade === 'D' && r.comprehensive_score < 20).length;
            const highWorkdayCount = results.filter(r => r.work_days > 25).length;
            const totalCriticalIssues = criticalLowlightCount + highWorkdayCount;

            if (totalCriticalIssues > 0) {
                const bannerHtml = `
                <div class="critical-alerts-banner">
                    <div class="banner-header">
                        <div class="banner-title">
                            <span>🚨</span>
                            <span>关键问题提醒</span>
                        </div>
                        <div class="banner-stats">
                            <div class="banner-stat">严重低绩效: ${criticalLowlightCount}人</div>
                            <div class="banner-stat">超高人天: ${highWorkdayCount}人</div>
                            <div class="banner-stat">总计: ${totalCriticalIssues}项</div>
                        </div>
                    </div>
                    <div class="banner-content">
                        ${criticalLowlightCount > 0 ? `• ${criticalLowlightCount}名员工综合得分低于20分，需要立即关注和干预<br>` : ''}
                        ${highWorkdayCount > 0 ? `• ${highWorkdayCount}名员工工作人天超过25天，建议核实数据记录准确性<br>` : ''}
                        这些问题可能影响团队整体效能和项目交付质量，建议优先处理。
                    </div>
                    <div class="banner-actions">
                        📋 建议立即查看下方的"Lowlight需关注"和"需核实人天记录"部分，按照建议步骤进行处理
                    </div>
                </div>
                `;
                document.getElementById('critical-alerts-banner').innerHTML = bannerHtml;
                document.getElementById('critical-alerts-banner').style.display = 'block';
            } else {
                document.getElementById('critical-alerts-banner').style.display = 'none';
            }

            // 更新团队改进建议
            const suggestions = generateActionableSuggestions(results, {
                avgOverdueRatio,
                avgOverdueDays,
                insufficientWork,
                seriousOverdue,
                highlightCount: highlightEmployees.length
            });
            document.getElementById('team-suggestions').innerHTML = suggestions;
        }

        // 生成逾期问题高亮
        function generateOverdueProblems(overdueStats) {
            const problems = [];

            if (overdueStats.avgOverdueRatio > 40) {
                problems.push({
                    title: '严重逾期警告',
                    value: `${overdueStats.avgOverdueRatio.toFixed(1)}%`,
                    description: '逾期比例严重超标，需要立即采取行动'
                });
            }

            if (overdueStats.avgOverdueDays > 8) {
                problems.push({
                    title: '项目延期严重',
                    value: `${overdueStats.avgOverdueDays.toFixed(1)}天`,
                    description: '平均延期时间过长，严重影响交付计划'
                });
            }

            if (overdueStats.seriousOverdue > overdueStats.totalPeople * 0.3) {
                problems.push({
                    title: '大面积严重逾期',
                    value: `${overdueStats.seriousOverdue}人`,
                    description: '超过30%的团队成员存在严重逾期问题'
                });
            }

            const problemsHtml = problems.length > 0 ? problems.map(problem => `
                <div class="problem-highlight">
                    <div class="problem-title">${problem.title}</div>
                    <div class="problem-value">${problem.value}</div>
                    <div style="font-size: 13px; color: #856404; margin-top: 4px;">${problem.description}</div>
                </div>
            `).join('') : '<div style="text-align: center; color: #27ae60; padding: 12px;">✅ 逾期状况在可控范围内</div>';

            document.getElementById('overdue-problems').innerHTML = problemsHtml;
        }

        // 生成团队改进建议
        function generateActionableSuggestions(results, stats) {
            const actions = [];
            const totalPeople = results.length;

            // 逾期问题行动建议
            if (stats.avgOverdueRatio > 40) {
                actions.push({
                    type: 'critical',
                    icon: '🚨',
                    title: '立即行动：解决严重逾期问题',
                    description: `团队平均逾期比例达到${stats.avgOverdueRatio.toFixed(1)}%，严重影响项目交付。需要立即采取行动。`,
                    metrics: [`逾期比例: ${stats.avgOverdueRatio.toFixed(1)}%`, `影响人数: ${Math.round(totalPeople * 0.6)}人`],
                    actions: ['召开紧急项目评审会', '重新评估任务时间估算', '建立每日进度跟踪机制']
                });
            } else if (stats.avgOverdueRatio > 25) {
                actions.push({
                    type: 'important',
                    icon: '⚠️',
                    title: '重点关注：改善逾期状况',
                    description: `逾期比例${stats.avgOverdueRatio.toFixed(1)}%超出可接受范围，需要重点关注。`,
                    metrics: [`当前: ${stats.avgOverdueRatio.toFixed(1)}%`, `目标: <20%`],
                    actions: ['优化任务分解', '增加周度进度检查', '识别阻塞因素']
                });
            }

            // 逾期天数行动建议
            if (stats.avgOverdueDays > 8) {
                actions.push({
                    type: 'critical',
                    icon: '📅',
                    title: '紧急：缩短项目周期',
                    description: `平均逾期${stats.avgOverdueDays.toFixed(1)}天，严重影响项目进度和客户满意度。`,
                    metrics: [`平均逾期: ${stats.avgOverdueDays.toFixed(1)}天`, `基准: 2天`],
                    actions: ['实施敏捷开发方法', '建立风险预警机制', '优化资源配置']
                });
            }

            // 工作量分布行动建议
            const insufficientPercentage = (stats.insufficientWork / totalPeople * 100).toFixed(1);
            if (stats.insufficientWork > totalPeople * 0.4) {
                actions.push({
                    type: 'important',
                    icon: '⚖️',
                    title: '重新平衡：工作任务分配',
                    description: `${insufficientPercentage}%的团队成员工作量不足，需要重新分配任务。`,
                    metrics: [`不足人数: ${stats.insufficientWork}人`, `占比: ${insufficientPercentage}%`],
                    actions: ['评估技能匹配度', '重新分配项目任务', '考虑跨部门协作']
                });
            }

            // 高人天核实行动建议
            const highWorkCount = results.filter(r => r.work_days > 15).length;
            if (highWorkCount > 0) {
                actions.push({
                    type: 'recommendation',
                    icon: '🔍',
                    title: '数据核实：验证高人天记录',
                    description: `发现${highWorkCount}人工作人天超过15天，需要核实数据准确性。`,
                    metrics: [`涉及人数: ${highWorkCount}人`, `需核实记录`],
                    actions: ['核查时间记录系统', '确认工作内容真实性', '建立数据审核机制']
                });
            }

            // 优秀表现认可
            if (stats.highlightCount > 0) {
                actions.push({
                    type: 'recommendation',
                    icon: '🏆',
                    title: '表彰优秀：树立学习榜样',
                    description: `${stats.highlightCount}名同事表现优秀，应该予以表彰并推广经验。`,
                    metrics: [`优秀人数: ${stats.highlightCount}人`, `占比: ${(stats.highlightCount/totalPeople*100).toFixed(1)}%`],
                    actions: ['组织经验分享会', '建立最佳实践库', '考虑晋升发展机会']
                });
            }

            // 如果没有严重问题，给出正面建议
            if (actions.length === 0) {
                actions.push({
                    type: 'recommendation',
                    icon: '✅',
                    title: '保持良好状态',
                    description: '团队整体表现良好，建议继续保持现有工作状态并持续优化。',
                    metrics: ['团队状态: 良好', '各项指标: 正常'],
                    actions: ['定期回顾总结', '持续改进流程', '关注团队成员发展']
                });
            }

            return actions.map(action => `
                <div class="action-item ${action.type}">
                    <div class="action-title">${action.icon} ${action.title}</div>
                    <div class="action-description">${action.description}</div>
                    <div style="margin-top: 8px;">
                        ${action.metrics.map(metric => `<span class="action-metric">${metric}</span>`).join('')}
                    </div>
                    <div style="margin-top: 8px; font-size: 13px; color: #6c757d;">
                        <strong>建议行动:</strong> ${action.actions.join(' → ')}
                    </div>
                </div>
            `).join('');
        }

        // 计算中位数
        function getMedian(numbers) {
            const sorted = numbers.slice().sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查文件上传支持
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                console.log('文件上传API支持');
            } else {
                showError('您的浏览器不支持文件上传功能');
            }
        });
    </script>
</body>
</html>